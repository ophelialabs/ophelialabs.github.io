<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart & Checkout Service | Ophelia Labs</title>
    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- PrismJS for code highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-okaidia.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa; 
        }
        .card-title {
            font-weight: 600;
        }
        .section-title {
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        pre[class*="language-"] {
            border-radius: 0.5rem;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>

    <main class="container-fluid">
                <p class="lead text-muted">An advanced microservice example for managing shopping carts, built with Kotlin, Micronaut, and Kafka.</p>

                <hr class="my-4">

                <section id="overview" class="mb-4">
                    <h2 class="section-title h4">Overview</h2>
                    <p>The Cart & Checkout service is a critical component in both online and brick-and-mortar retail systems. This example demonstrates a modern, event-driven microservice architecture designed for scalability and resilience.</p>
                    <p>It exposes a RESTful API for cart operations and integrates with Kafka to publish events, allowing other services (e.g., inventory, order processing) to react to cart changes in real-time.</p>
                </section>

                <section id="tech-stack" class="mb-4">
                    <h2 class="section-title h4">Technology Stack</h2>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Languages:</strong> <a href="https://kotlinlang.org/">Kotlin</a>, <a href="https://groovy-lang.org/">Groovy</a></li>
                        <li class="list-group-item"><strong>Frameworks:</strong> <a href="https://micronaut.io/">Micronaut</a>, <a href="https://ratpack.io/">Ratpack</a></li>
                        <li class="list-group-item"><strong>Databases:</strong> <a href="https://www.postgresql.org/">Postgres</a> (with an in-memory fallback for this example)</li>
                        <li class="list-group-item"><strong>Event Streaming:</strong> <a href="https://kafka.apache.org/">Kafka</a></li>
                        <li class="list-group-item"><strong>Architecture:</strong> Microservices, Event-Driven, Multi-Tenant</li>
                        <li class="list-group-item"><strong>Containerization:</strong> <a href="https://www.docker.com/">Docker</a> & <a href="https://docs.docker.com/compose/">Docker Compose</a></li>
                    </ul>
                </section>

                <section id="getting-started" class="mb-4">
                    <h2 class="section-title h4">Getting Started</h2>
                    <p>Follow these steps to build and run the entire stack locally using Docker Compose.</p>
                    <ol class="list-group list-group-numbered">
                        <li class="list-group-item border-0">
                            <strong>Navigate to the service directory</strong>
                            <p class="mb-1 mt-2">All commands should be run from the <code>cart-service</code> directory.</p>
                            <pre><code class="language-bash">cd cart-service</code></pre>
                        </li>
                        <li class="list-group-item border-0">
                            <strong>Run services with Docker Compose</strong>
                            <p class="mb-1 mt-2">This command builds the service image and starts the <code>cart-service</code>, a PostgreSQL database, and a Kafka cluster.</p>
                            <pre><code class="language-bash">docker-compose up --build</code></pre>
                        </li>
                        <li class="list-group-item border-0">
                            <strong>Interact with the service</strong>
                            <p class="mb-1 mt-2">Once the containers are running, you can use <code>curl</code> to interact with the API.</p>
                            
                            <h6 class="mt-3">Create a Cart:</h6>
                            <p>Send a POST request with the cart data. This will create the cart and publish a <code>CART_CREATED</code> event to Kafka.</p>
                            <pre><code class="language-bash">curl -X POST http://localhost:8080/cart \
-H "Content-Type: application/json" \
-d '{
      "id": "a8c6e5e6-4b8a-4b9f-8b9e-0e1f2b3c4d5e",
      "items": [
        { "productId": "prod-123", "quantity": 2, "price": 19.99 }
      ]
    }'</code></pre>

                            <h6 class="mt-3">Get a Cart:</h6>
                            <p>Retrieve the cart you just created using its ID.</p>
                            <pre><code class="language-bash">curl http://localhost:8080/cart/a8c6e5e6-4b8a-4b9f-8b9e-0e1f2b3c4d5e</code></pre>
                        </li>
                    </ol>
                </section>

                <section id="architecture" class="mb-4">
                    <h2 class="section-title h4">Service Architecture</h2>
                    <p>The service is composed of several layers, each with a distinct responsibility:</p>
                    <div class="accordion" id="architectureAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingController">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseController">
                                    <strong>Controller Layer</strong> (<code>CartController.kt</code>)
                                </button>
                            </h2>
                            <div id="collapseController" class="accordion-collapse collapse" data-bs-parent="#architectureAccordion">
                                <div class="accordion-body">
                                    This is the entry point for all HTTP requests. It uses Micronaut's declarative annotations (<code>@Controller</code>, <code>@Get</code>, <code>@Post</code>) to define API endpoints. It delegates all business logic to the <code>CartService</code>.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingService">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseService">
                                    <strong>Service Layer</strong> (<code>CartService.kt</code>)
                                </button>
                            </h2>
                            <div id="collapseService" class="accordion-collapse collapse" data-bs-parent="#architectureAccordion">
                                <div class="accordion-body">
                                    Contains the core business logic. When a cart is created, it first saves the cart to the repository and then uses the <code>CartEventProducer</code> to send a notification to a Kafka topic.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingKafka">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseKafka">
                                    <strong>Event Producer</strong> (<code>CartEventProducer.kt</code>)
                                </button>
                            </h2>
                            <div id="collapseKafka" class="accordion-collapse collapse" data-bs-parent="#architectureAccordion">
                                <div class="accordion-body">
                                    An interface annotated with <code>@KafkaClient</code>. Micronaut automatically provides an implementation that can send messages to the specified Kafka topic (<code>cart-events</code>). This decouples the cart service from its consumers.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingRepository">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRepository">
                                    <strong>Repository Layer</strong> (<code>CartRepository.kt</code>)
                                </button>
                            </h2>
                            <div id="collapseRepository" class="accordion-collapse collapse" data-bs-parent="#architectureAccordion">
                                <div class="accordion-body">
                                    Handles data persistence. For this example, it uses a simple in-memory <code>ConcurrentHashMap</code> to store carts. However, the application is configured via <code>application.yml</code> to connect to a PostgreSQL database, and this repository could be easily swapped with a JDBC-based implementation (e.g., using Micronaut Data) for production use.
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="file-structure">
                    <h2 class="section-title h4">Project File Structure</h2>
                    <p>Key files and their purpose within the <code>cart-service</code> directory:</p>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">File / Directory</th>
                                <th scope="col">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>build.gradle.kts</code></td>
                                <td>The Gradle build script. It defines project dependencies like Micronaut, Kotlin, Kafka, and PostgreSQL, and configures the build process.</td>
                            </tr>
                            <tr>
                                <td><code>docker-compose.yml</code></td>
                                <td>Orchestrates the multi-container environment. It defines the <code>cart-service</code> itself, along with its dependencies: a <code>postgres</code> database, a <code>kafka</code> broker, and <code>zookeeper</code>.</td>
                            </tr>
                            <tr>
                                <td><code>Dockerfile</code></td>
                                <td>Instructions for building the Docker image for the <code>cart-service</code>. It copies the compiled JAR file into a lightweight OpenJDK image.</td>
                            </tr>
                            <tr>
                                <td><code>src/main/kotlin/...</code></td>
                                <td>Contains all the Kotlin source code for the application, including controllers, services, models, and repository logic.</td>
                            </tr>
                            <tr>
                                <td><code>src/main/resources/application.yml</code></td>
                                <td>The Micronaut configuration file. It defines the application name, Kafka server location, and database connection details. It uses environment variables for dynamic configuration.</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
    </main>

    <!-- Bootstrap & PrismJS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>