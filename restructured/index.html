<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ophelia Labs - Research, Infrastructure & Resources</title>
    <meta name="description" content="Comprehensive platform for quantum computing research, enterprise infrastructure, and technical resources.">
    <meta name="keywords" content="quantum computing, infrastructure, research, deployment, enterprise, Q#, Python, HDF5">
    <meta property="og:title" content="Ophelia Labs - Research & Infrastructure">
    <meta property="og:description" content="Comprehensive platform for quantum computing research, enterprise infrastructure, and technical resources.">
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'dark',
            securityLevel: 'loose',
            themeVariables: {
                primaryColor: '#0d0d0d',
                primaryTextColor: '#fff',
                primaryBorderColor: '#333',
                fontSize: '14px',
                fontFamily: 'Arial, sans-serif'
            }
        });
    </script>
</head>
<body>
    <div id="navbar"></div>
    <div id="sidebar"></div>
    <main id="main-content">
        <!-- Research Section -->
        <div id="quantum-computing" class="page active"></div>
        <div id="data-resources" class="page"></div>
        <div id="tools-catalog" class="page"></div>
        
        <!-- Infrastructure Section -->
        <div id="deployment-pipeline" class="page"></div>
        <div id="cloud-platforms" class="page"></div>
        <div id="architecture-docs" class="page"></div>
        <div id="dx-netops" class="page"></div>
        
        <!-- Resources Section -->
        <div id="universities" class="page"></div>
        <div id="journals" class="page"></div>
        <div id="publications" class="page"></div>
        <div id="geofence" class="page"></div>
        <div id="mat-cs" class="page"></div>
        
        <!-- Admin Section -->
        <div id="dashboard" class="page"></div>
        <div id="users-management" class="page"></div>
        <div id="settings" class="page"></div>
    </main>
    
    <script src="assets/js/app.js"></script>
    <script>
        // Page configuration
        const PAGES = {
            'quantum-computing': 'content/research/quantum-computing.html',
            'data-resources': 'content/research/data-resources.html',
            'tools-catalog': 'content/research/tools-catalog.html',
            'deployment-pipeline': 'content/infrastructure/deployment-pipeline.html',
            'cloud-platforms': 'content/infrastructure/cloud-platforms.html',
            'architecture-docs': 'content/infrastructure/architecture-docs.html',
            'dx-netops': 'content/infrastructure/dx-netops.md',
            'universities': 'content/resources/universities.html',
            'journals': 'content/resources/journals.html',
            'publications': 'content/resources/publications.html',
            'geofence': 'content/research/geofence.html',
            'dashboard': 'content/admin/dashboard.html',
            'mat-cs': 'content/resources/mat-cs/mat-cs.md',
            'users-management': 'content/admin/users-management.html',
            'settings': 'content/admin/settings.html'
        };

        const loadedPages = new Set();

        // Load navbar and sidebar
        Promise.all([
            fetch('assets/layout/navbar.html').then(r => r.text()),
            fetch('assets/layout/sidebar.html').then(r => r.text())
        ]).then(([navbar, sidebar]) => {
            document.getElementById('navbar').innerHTML = navbar;
            document.getElementById('sidebar').innerHTML = sidebar;
            initNavbar();
            initSidebar();
        }).catch(error => console.error('Error loading layout:', error));

        function loadPageContent(pageId) {
            if (!PAGES.hasOwnProperty(pageId)) {
                console.warn('Page not found:', pageId);
                return Promise.reject('Page not found');
            }

            const pageElement = document.getElementById(pageId);
            if (!pageElement) {
                console.warn('Page element not found:', pageId);
                return Promise.reject('Element not found');
            }

            const filePath = PAGES[pageId];
            const isMarkdown = filePath.endsWith('.md');

            return fetch(filePath)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return response.text();
                })
                .then(content => {
                    if (isMarkdown) {
                        // Convert markdown to HTML
                        const html = marked.parse(content);
                        pageElement.innerHTML = `<div class="content-section">${html}</div>`;
                    } else {
                        pageElement.innerHTML = content;
                    }
                    loadedPages.add(pageId);
                    
                    // Render Mermaid diagrams after content is loaded
                    if (window.mermaid) {
                        setTimeout(() => {
                            try {
                                mermaid.run();
                            } catch (err) {
                                console.warn('Error rendering mermaid diagrams:', err);
                            }
                        }, 100);
                    }
                })
                .catch(error => {
                    console.error(`Error loading page ${pageId}:`, error);
                    pageElement.innerHTML = `<div class="content-section"><h1>Error Loading Page</h1><p>Could not load content: ${error}</p></div>`;
                });
        }

        function navigateToPage(hash) {
            const pageId = (hash.substring(1) || 'quantum-computing').toLowerCase();
            
            if (!PAGES.hasOwnProperty(pageId)) {
                console.warn('Invalid page ID:', pageId);
                return;
            }

            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Show and load target page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                
                // Load content if not already loaded
                if (!loadedPages.has(pageId)) {
                    loadPageContent(pageId);
                } else {
                    // Already loaded, just render mermaid if needed
                    if (window.mermaid) {
                        setTimeout(() => {
                            try {
                                mermaid.run();
                            } catch (err) {
                                console.warn('Error rendering mermaid:', err);
                            }
                        }, 100);
                    }
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial page
            navigateToPage(window.location.hash);
            
            // Handle hash changes
            window.addEventListener('hashchange', () => {
                navigateToPage(window.location.hash);
            });
        });
    </script>
</body>
</html>
